<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Votazione Skills Calcio</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: url('campo.jpg') no-repeat center center fixed;
    background-size: cover;
    color: #fff;
    text-align: center;
  }
  .login-container, .players-container {
    background-color: rgba(0,0,0,0.7);
    padding: 20px;
    margin: 20px auto;
    border-radius: 10px;
    max-width: 800px;
  }
  .player-card {
    background-color: rgba(255,255,255,0.1);
    padding: 15px;
    margin: 10px 0;
    border-radius: 8px;
  }
  .bar-container {
    width: 100%;
    background-color: #333;
    border-radius: 5px;
    margin: 5px 0;
  }
  .bar {
    height: 20px;
    border-radius: 5px;
  }
  .bar.skills { background-color: green; }
</style>
</head>
<body>

<div class="login-container" id="login-container">
  <h2>Seleziona il tuo nome</h2>
  <select id="playerSelect">
    <option value="">-- Scegli --</option>
  </select>
  <button onclick="login()">Entra</button>
</div>

<div class="players-container" id="players-container" style="display:none;">
  <h2>Vota le Skills</h2>
  <div id="players-list"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBkuiFqFj1EZKoByZpjWwVlK_lUIx91iwg",
  authDomain: "skills-giocatori.firebaseapp.com",
  projectId: "skills-giocatori",
  storageBucket: "skills-giocatori.firebasestorage.app",
  messagingSenderId: "392075208696",
  appId: "1:392075208696:web:e2b010f9ae0af6272e980d",
  measurementId: "G-ZZ6NZPEPMP"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const players = ["Alex","Abbate","Sasi","Gino","Nicola","Andrea","Giovanni","Enzo","Isidoro","Cerullo","Petterutti","Errico","Mazza"];
const skills = ["attacco","difesa","velocita","resistenza","forza","dribbling","tiro","passaggio","senso_tattico"];

let currentUser = "";

window.onload = () => {
  const select = document.getElementById('playerSelect');
  players.forEach(p => {
    let opt = document.createElement('option');
    opt.value = p;
    opt.textContent = p;
    select.appendChild(opt);
  });
};

function login() {
  const selected = document.getElementById('playerSelect').value;
  if(!selected) { alert("Seleziona il tuo nome!"); return; }
  currentUser = selected;
  document.getElementById('login-container').style.display = 'none';
  document.getElementById('players-container').style.display = 'block';
  loadPlayers();
}

function getRendimentoColor(val) {
  if(val <= 2) return "red";
  if(val <= 4) return "orange";
  if(val <= 6) return "yellow";
  if(val <= 8) return "green";
  return "lightblue";
}

function loadPlayers() {
  players.forEach(name => {
    const docRef = db.collection("giocatori").doc(name);
    docRef.get().then(doc => {
      if(!doc.exists) {
        let data = {};
        skills.forEach(s => data[s] = 0);
        data.rendimento = 0;
        docRef.set(data);
      }
    });
  });

  db.collection("giocatori").onSnapshot(snapshot => {
    const container = document.getElementById('players-list');
    container.innerHTML = "";
    snapshot.forEach(doc => {
      const data = doc.data();
      const name = doc.id;
      let div = document.createElement('div');
      div.className = 'player-card';
      let html = `<h3>${name}</h3>`;
      skills.forEach(s => {
        let val = data[s] || 0;
        html += `<div>${s} (${val.toFixed(1)})</div>
                 <div class="bar-container"><div class="bar skills" style="width:${(val/5)*100}%"></div></div>`;
      });
      let valR = data.rendimento || 0;
      html += `<div>Rendimento (${valR.toFixed(1)})</div>
               <div class="bar-container"><div class="bar" style="background-color:${getRendimentoColor(valR)};width:${(valR/10)*100}%"></div></div>`;
      if(name !== currentUser) {
        html += `<div>
          <label>Vota skills:</label><br>`;
        skills.forEach(s => {
          html += `${s}: <input type="number" min="0" max="5" id="vote_${name}_${s}" value="0"><br>`;
        });
        html += `Rendimento: <input type="number" min="0" max="10" id="vote_${name}_rendimento" value="${valR}"><br>
                 <button onclick="vote('${name}')">Invia Voto</button>
                 </div>`;
      }
      div.innerHTML = html;
      container.appendChild(div);
    });
  });
}

function vote(playerName) {
  let updates = {};
  skills.forEach(s => {
    let v = parseFloat(document.getElementById(`vote_${playerName}_${s}`).value) || 0;
    if(v<0) v=0; if(v>5) v=5;
    updates[s] = firebase.firestore.FieldValue.increment(v);
  });
  let vr = parseFloat(document.getElementById(`vote_${playerName}_rendimento`).value) || 0;
  if(vr<0) vr=0; if(vr>10) vr=10;
  updates.rendimento = firebase.firestore.FieldValue.increment(vr);
  db.collection("giocatori").doc(playerName).update(updates);
}
</script>
</body>
</html>
